      - name: Fetch Docker package URLs
        id: docker_urls
        run: |
          set -euo pipefail
          BASE_URL="https://download.docker.com/linux/ubuntu/dists/${UBUNTU_CODENAME}/pool/stable/${ARCH}"
          
          echo "DEBUG: Fetching page content from $BASE_URL/"
          # 使用 -L 处理重定向，增加 --retry 应对临时网络问题
          PAGE_CONTENT=$(curl -fsSL -L --retry 3 "$BASE_URL/" | tr -d '\r')
          
          # 精确提取包文件名的函数
          get_latest() {
            local pkg="$1"
            echo "DEBUG: Trying to find latest package for: $pkg"
            
            # 使用更健壮的正则表达式
            # 1. 匹配 <a href="..."> 标签
            # 2. 捕获以 $pkg 开头并以 .deb 结尾的完整文件名
            # 3. 使用 sed 提取 href 属性的值，这比 grep + cut 更可靠
            local matches=$(echo "$PAGE_CONTENT" | grep -oE "<a href=\"${pkg}[^\"]+\.deb\">" | sed -n 's/.*href="\([^"]*\)".*/\1/p')
            
            if [ -z "$matches" ]; then
              echo "ERROR: No package found for $pkg" >&2
              echo "ERROR: Please check if the package name is correct." >&2
              exit 1
            fi
            
            # 输出所有匹配到的结果，方便调试
            echo "DEBUG: All found matches for $pkg:"
            echo "$matches"
            
            # 按版本号排序并取最新版本
            local latest=$(echo "$matches" | sort -Vr | head -n1)
            echo "DEBUG: Latest version for $pkg is: $latest"
            echo "$latest"
          }

          # 获取各组件最新包文件名
          CONTAINERD=$(get_latest "containerd.io")
          DOCKER_CE=$(get_latest "docker-ce")
          CLI=$(get_latest "docker-ce-cli")
          BUILDX_PLUGIN=$(get_latest "docker-buildx-plugin")
          COMPOSE_PLUGIN=$(get_latest "docker-compose-plugin")

          # 输出完整下载URL
          echo "CONTAINERD_URL=${BASE_URL}/${CONTAINERD}" >> $GITHUB_OUTPUT
          echo "DOCKER_CE_URL=${BASE_URL}/${DOCKER_CE}" >> $GITHUB_OUTPUT
          echo "CLI_URL=${BASE_URL}/${CLI}" >> $GITHUB_OUTPUT
          echo "BUILDX_PLUGIN_URL=${BASE_URL}/${BUILDX_PLUGIN}" >> $GITHUB_OUTPUT
          echo "COMPOSE_PLUGIN_URL=${BASE_URL}/${COMPOSE_PLUGIN}" >> $GITHUB_OUTPUT
